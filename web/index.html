<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="Mark Otto, Jacob Thornton, and Bootstrap contributors">
    <meta name="generator" content="Hugo 0.80.0">
    <title>RandomMeme</title>
    <link rel="canonical" href="https://getbootstrap.com/docs/4.6/examples/cover/">
    <!-- Bootstrap core CSS -->
    <link href="assets/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
    <!-- Fancybox core CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css">

    <style>
        .bd-placeholder-img {
            font-size: 1.125rem;
            text-anchor: middle;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        @media (min-width: 768px) {
            .bd-placeholder-img-lg {
                font-size: 3.5rem;
            }
        }

        .content-div {
            width: 500px;
            height: 400px
        }

        .none-content-div {
            font-size: 3rem;
            color: white;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .hide-loading {
            display: none !important;
        }

        .content-img {
            display: none;
            max-width: 100%;
            max-height: 100%;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .content-i {
            display: none;
            font-size: 3rem;
            color: white;
            position: relative;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .icon-font-size {
            font-size: 20px
        }

        .cursor-pointer {
            cursor: pointer;
        }
    </style>
    <!-- Custom styles for this template -->
    <link href="css/cover.css" rel="stylesheet">
</head>

<body class="text-center">
<div class="cover-container d-flex w-100 h-100 p-3 mx-auto flex-column">
    <header class="masthead mb-auto">
        <div class="inner">
            <h3 class="masthead-brand">RandomMeme</h3>
            <nav class="nav nav-masthead justify-content-center">
                <a class="nav-link active" href="#">首页</a>
                <a class="nav-link" target="_blank" href="https://github.com/lsiuf/random-meme-doc/issues/1">
                    <i class="bi bi-github" style="font-size: 16px;"></i> 建议
                </a>
                <a class="nav-link" href="#">打赏</a>
            </nav>
        </div>
    </header>

    <main role="main" class="inner cover">
        <div class="container">

            <div class="row">
                <!-- 作者 -->
                <div class="col text-left">
                    <i class="bi bi-person"></i>
                    <span id="author" style="color: rgba(255, 255, 255, .5);"> -</span>
                </div>
                <!-- 内容编号 -->
                <div class="col text-right">
                    <span id="content-code" class="align-bottom" style="color: rgba(255, 255, 255, .5);"></span>
                </div>
            </div>

            <!-- 内容 -->
            <div class="row">
                <div class="col">
                    <!-- 内容主题 -->
                    <div class="content-div">
                        <!-- loading控件 -->
                        <div id="loading" class="d-flex justify-content-center align-items-center"
                             style="width: 100%; height: 100%;">
                            <div class="spinner-border text-light" role="status">
                                <span class="sr-only">Loading...</span>
                            </div>
                        </div>
                        <!-- 多媒体插件 fancybox -->
                        <a id="content" data-fancybox="content">
                            <!-- 缩略图 -->
                            <img id="img-tag" class="content-img" alt="加载中..." onLoad="imgOnLoad()"/>
                            <!-- 视频播放按钮 -->
                            <i id="video-tag" class="bi bi-play-circle content-i"></i>
                        </a>
                        <!-- 无内容时展示Icon -->
                        <div id="none-content" class="none-content-div">
                            <i class="bi bi-emoji-dizzy"></i>
                            <p>暂无可展示内容</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 其他数据 -->
            <div class="row font-weight-bolder text-left icon-font-size">
                <!-- 推荐数 -->
                <div class="col">
            <span class="recommend-click cursor-pointer">
              <i id="recommend-icon" class="bi bi-hand-thumbs-up"></i>
              <span id="recommend"> -</span>
            </span>
                </div>
                <!-- 不推荐数 -->
                <div class="col">
            <span class="notrecommend-click cursor-pointer">
              <i id="notrecommend-icon" class="bi bi-hand-thumbs-down"></i>
              <span id="notrecommend"> -</span>
            </span>
                </div>
                <!-- 阅读数 -->
                <div class="col">
                    <i class="bi bi-eye"></i><span id="pageview"> -</span>
                </div>
                <!-- 评论数 -->
                <div class="col">
            <span class="comment-click">
              <i class="bi bi-chat-right-dots"></i><span id="comment"> -</span>
            </span>
                </div>
            </div>

            <!-- 再看一张按钮 -->
            <div class="row mt-5">
                <div class="col">
                    <button type="button" class="btn btn-outline-light next-click" style="font-size: 24px;">
                        再看一张
                        <i class="bi bi-emoji-sunglasses-fill"></i>
                        !
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="mastfoot mt-auto">
        <div class="inner">
            <!-- <p>Cover template for <a href="https://getbootstrap.com/">Bootstrap</a>, by <a
                href="https://twitter.com/mdo">@mdo</a>.</p> -->
            <p>随机一张有意思的图片</p>
        </div>
    </footer>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.0.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script>
<script src="js/api.js"></script>

<script>
    var contentObj = {};
</script>

<script>
    // 查询内容
    function getContent() {
        $.get(getContentUrl, (data, status) => {
            contentObj = data;
            //隐藏无内容控件
            $('#none-content').hide();
            //set 多媒体插件资源路径
            $('#content').attr('href', baseImageUrl + data.fileName);
            //set 阅读数
            $('#pageview').text(' ' + data.view);
            //set 内容编号
            $('#content-code').text(data.contentCode);
            //set 推荐数
            $('#recommend').text(' ' + data.recommend);
            //set 阅读数
            $('#notrecommend').text(' ' + data.notRecommend);
            //set 作者
            $('#author').text(' ' + (data.author ? data.author : '-'));

            //隐藏缩略图和视频播放按钮
            $('#img-tag').hide();
            $('#video-tag').hide();
            //根据内容类型显示缩略图或视频播放按钮
            if (data.type == 1 || data.type == 2) {
                //显示loading
                $('#loading').removeClass('hide-loading');
                //设置图片资源路径
                $('#img-tag').attr('src', baseImageUrl + data.fileName);
            } else {
                //显示视频播放按钮
                $('#video-tag').show();
            }

            //推荐、不推荐按钮置灰
            $('#recommend-icon').attr('class', 'bi bi-hand-thumbs-up');
            $('#notrecommend-icon').attr('class', 'bi bi-hand-thumbs-down');

            //根据用户是否推荐判断点亮按钮
            if (data.userRecommendType != null) {
                //点亮推荐
                if (data.userRecommendType == 1) {
                    $('#recommend-icon').attr('class', 'bi bi-hand-thumbs-up-fill');
                }
                //点亮不推荐
                if (data.userRecommendType == 0) {
                    $('#notrecommend-icon').attr('class', 'bi bi-hand-thumbs-down-fill');
                }
            }
        });
    }

    // 推荐内容接口
    function recommend() {
        let url = recommendUrl + '?contentId=' + contentObj.id;
        $.get(url, (data, status) => {
            updateRecommend(true);
        });
    }

    // 不推荐内容接口
    function notrecommend() {
        let url = notRecommendUrl + '?contentId=' + contentObj.id;
        $.get(url, (data, status) => {
            updateRecommend(false);
        });
    }

    /**
     * 点击推荐： 点亮推荐icon、置灰不推荐icon
     * 点击不推荐： 点亮不推荐icon、置灰推荐icon
     **/
    function updateRecommend(isRecommend) {
        if (isRecommend) {
            $('#recommend-icon').attr('class', 'bi bi-hand-thumbs-up-fill');
            $('#notrecommend-icon').attr('class', 'bi bi-hand-thumbs-down');

        } else {
            $('#notrecommend-icon').attr('class', 'bi bi-hand-thumbs-down-fill');
            $('#recommend-icon').attr('class', 'bi bi-hand-thumbs-up');
        }
    }

    // 初始化多媒体控件
    function initFancybox() {
        Fancybox.bind("[data-fancybox]", {
            // Your options go here
        });
    }

    // 预览图加载事件
    function imgOnLoad() {
        //隐藏loading
        $('#loading').addClass('hide-loading');
        //显示图片
        setTimeout(() => {
            $('#img-tag').show();
        }, 100);
    }
</script>

<script>
    // 推荐按钮点击事件
    $('.recommend-click').click(() => {
        if ($('#recommend-icon').hasClass('bi-hand-thumbs-up-fill')) {
            return;
        }
        recommend();
    });

    // 不推荐按钮点击事件
    $('.notrecommend-click').click(() => {
        if ($('#notrecommend-icon').hasClass('bi-hand-thumbs-down-fill')) {
            return;
        }
        notrecommend();
    });

    // 再看一张按钮点击事件
    $('.next-click').click(() => {
        getContent();
    });
</script>

<script>
    initFancybox();
    getContent();
</script>

</html>